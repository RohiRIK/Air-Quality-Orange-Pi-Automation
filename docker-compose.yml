version: '3.8'
services:
  backend:
    build: ./backend
    image: rohirikman/air-quality-backend # Update image name
    container_name: air-quality-backend
    # restart: unless-stopped
    privileged: true
    # We are not mapping port 5000 to the host, as the frontend will proxy to it
    # If direct access to backend for debugging is needed, add - "5001:5000"
    devices:
      - "/dev/i2c-0:/dev/i2c-0"
    environment:
      - BLINKA_FORCE_BOARD=ORANGE_PI_3_LTS
      - BLINKA_FORCE_CHIP=ALLWINNER_H6
    env_file:
      - .env
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  frontend:
    build: ./frontend
    image: rohirikman/air-quality-frontend # Update image name
    container_name: air-quality-frontend
    restart: unless-stopped
    ports:
      - "5000:80" # Map host port 5000 to Nginx's default port 80
    depends_on:
      - backend # Ensure backend starts before frontend
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --schedule "0 0 4 * * *" --cleanup
